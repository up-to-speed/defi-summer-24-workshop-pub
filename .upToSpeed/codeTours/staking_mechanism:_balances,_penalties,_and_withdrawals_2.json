{"title":"Staking Mechanism: Balances, Penalties, and Withdrawals","id":"R8HHqSxDMqtLarxzG9odCKnvpBMFSAWB4q1kJdZT9HU=","position":2,"steps":[{"type":"textOnly","description":"The Staking contract manages user stakes and withdrawals with time-locked staking and early exit penalties. Key features: user stake management, reward calculation, and withdrawal mechanisms.","title":"","id":"18"},{"type":"highlight","description":"Staking contract uses `userEarnings` for earnings info and `balances` for user balances.","file":"src/Staking.sol","highlight":[{"start":4,"end":6}],"title":"","id":"19"},{"type":"highlight","description":"The `ieeWithdrawableBalances` function calculates user's withdrawable amount for a specific unlock time. It finds the matching earnings entry and determines withdrawable amount, penalties, and burn amount.","file":"src/Staking.sol","highlight":[{"start":17,"end":32}],"title":"","id":"20"},{"type":"highlight","description":"`individualEarlyExit` handles early token withdrawals, applying penalties to balance user flexibility with long-term staking incentives.","file":"src/Staking.sol","highlight":[{"start":39,"end":39}],"title":"","id":"21"},{"type":"highlight","description":"Validates unlock time and calculates withdrawable amounts using ieeWithdrawableBalances. Ensures valid early withdrawals and correct amount calculations.","file":"src/Staking.sol","highlight":[{"start":40,"end":45}],"title":"","id":"22"},{"type":"highlight","description":"Updates user's earnings record by removing the withdrawn entry and shifting remaining entries, maintaining accurate staking history.","file":"src/Staking.sol","highlight":[{"start":51,"end":58}],"title":"","id":"23"},{"type":"highlight","description":"Updates user's total and earned balances, subtracting withdrawn amount and penalties.","file":"src/Staking.sol","highlight":[{"start":60,"end":62}],"title":"","id":"24"},{"type":"highlight","description":"`_withdrawTokens` handles token transfer, applying penalties, and optional reward claiming.","file":"src/Staking.sol","highlight":[{"start":64,"end":64}],"title":"","id":"25"},{"type":"textOnly","description":"Key security aspects to audit in the Staking contract:\n\n1. Reentrancy in withdrawals\n2. Balance and penalty calculation accuracy\n3. Unlock time and penalty manipulation\n4. Access control\n5. Precision in math operations","title":"","id":"26"}]}